Сценарии работы с переменными окружения в Dockerfile (ARG пока не трогаем):

1) Статическое значение через ENV:

FROM busybox
RUN echo $E1
ENV E1=never
RUN echo $E1

Вывод:
"
never"

Аналог(и):
- hosts: localhost
  name: Test
  tasks:
    - debug:
        msg: "{{ E1 | default('')}}"
    - set_fact:
        E1: never
    - debug:
        msg: "{{ E1 | default('')}}"


2) Статическое значение в RUN:

FROM busybox
RUN E1=never; echo $E1
RUN echo $E1

Вывод:
"never
"

Аналог(и):
- hosts: localhost
  name: Test
  tasks:
    - debug:
        msg: "{{ E1 | default('')}}"
      vars:
        E1: never
    - debug:
        msg: "{{ E1 | default('')}}"


3) Статическое значение в RUN (export) - пока равносильно предыдущему:

FROM busybox
RUN echo $E1
RUN export E1=never; echo $E1
RUN echo $E1

вывод:
"
never
"

Аналог(и):
- hosts: localhost
  name: Test
  tasks:
    - debug:
        msg: "{{ E1 | default('')}}"
    - debug:
        msg: "{{ E1 | default('')}}"
      vars:
        E1: never
    - debug:
        msg: "{{ E1 | default('')}}"


4) Динамическое значение через ENV:

FROM busybox
RUN echo $E1
ENV E1=never
RUN echo $E1
ENV E1=never
