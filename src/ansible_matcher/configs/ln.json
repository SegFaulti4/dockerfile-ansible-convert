{
    "ln": {
        "entry": "ln <<parameters : m>>",
        "opts": {
            "force": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-f", "--force"]
            },
            "symbolic": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-s", "--symbolic"]
            },
            "no dereference": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-n", "--no-dereference"]
            },
            "directory": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-d", "-F", "--directory"]
            },
            "no target directory": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-T", "--no-target-directory"]
            },
            "verbose": {
                "arg_required": false,
                "many_args": false,
                "aliases": ["-v", "--verbose"]
            }
        },
        "examples": {
            "ln -s <<globs : m>> <<dest : p>>": [
                {
                    "ansible.builtin.stat": {
                        "path": "<<dest>>",
                        "follow": false
                    },
                    "changed_when": false,
                    "register": "st_reg"
                },
                {
                    "ansible.builtin.shell": {
                        "cmd": "realpath -sm {{ files }}",
                        "chdir": "{{ dest if dest_is_dir else (dest | dirname) }}"
                    },
                    "vars": {
                        "files": "<<globs>>",
                        "dest": "<<dest>>",
                        "dest_is_dir": "{{ (st_reg.stat.isdir is defined and st_reg.stat.isdir) | ternary(true, false) }}"
                    },
                    "changed_when": false,
                    "register": "ls_reg"
                },
                {
                    "ansible.builtin.fail": {
                        "msg": "Failed to create symlink - last file is not a directory"
                    },
                    "when": [
                        "ls_reg.stdout_lines | length > 1",
                        "st_reg.stat.isdir is undefined or st_reg.stat.isdir == False"
                    ]
                },
                {
                    "ansible.builtin.file": {
                        "state": "link",
                        "force": true,
			            "follow": false,
                        "src": "{{ item }}",
                        "path": "{{ ((dest, item | basename) | path_join) if dest_is_dir else dest }}"
                    },
                    "loop": "{{ ls_reg.stdout_lines }}",
                    "vars": {
                        "dest": "<<dest>>",
                        "dest_is_dir": "{{ (st_reg.stat.isdir is defined and st_reg.stat.isdir) | ternary(true, false) }}"
                    }
                }
            ],
            "ln -s <<src>>": [
                {
                    "ansible.builtin.file": {
                        "state": "link",
                        "force": true,
			            "follow": false,
                        "src": "{{ src }}",
                        "path": "{{ (cwd, src | basename) | path_join }}"
                    },
                    "vars": {
                        "cwd": "<<cwd>>",
                        "src": "<<src>>"
                    }
                }
            ]
        },
        "opts_postprocess": {
            "--force": {},
            "--no-dereference": {
                "ansible.builtin.file": {
                    "follow": false
                }
            },
            "--verbose": {}
        }
    }
}
